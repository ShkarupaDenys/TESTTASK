{"ast":null,"code":"import _regeneratorRuntime from\"/Users/shkarupadenis/Documents/personal/TESTTASK/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/shkarupadenis/Documents/personal/TESTTASK/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/Users/shkarupadenis/Documents/personal/TESTTASK/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/shkarupadenis/Documents/personal/TESTTASK/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{getUsersFromServer}from\"api\";import{useCallback,useMemo,useState}from\"react\";import{Loading}from\"types\";import{API}from\"utils/fetchClient\";export var useUser=function useUser(){var _useState=useState('/api/v1/users?page=1&count=6'),_useState2=_slicedToArray(_useState,2),nextUrl=_useState2[0],setNextUrl=_useState2[1];var _useState3=useState(Loading.None),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),users=_useState6[0],setUsers=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),newUser=_useState8[0],setNewUser=_useState8[1];var visibleUsers=useMemo(function(){return _toConsumableArray(users);},[users]);var getUsers=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$getUsersFromSe,links,_users,path;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:setLoading(Loading.ShowMore);_context.prev=1;_context.next=4;return getUsersFromServer(nextUrl);case 4:_yield$getUsersFromSe=_context.sent;links=_yield$getUsersFromSe.links;_users=_yield$getUsersFromSe.users;path=links.next_url;if(visibleUsers.length){_context.next=12;break;}setUsers(_users);setNextUrl(path.replace(API,''));return _context.abrupt(\"return\");case 12:setNextUrl(path?path.replace(API,''):null);setUsers(function(oldData){return[].concat(_toConsumableArray(oldData),_toConsumableArray(_users));});_context.next=19;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](1);console.error(_context.t0);case 19:_context.prev=19;setLoading(Loading.None);return _context.finish(19);case 22:case\"end\":return _context.stop();}},_callee,null,[[1,16,19,22]]);})),[nextUrl,visibleUsers.length]);var addNewUser=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(userId){var count,_yield$getUsersFromSe2,_users2;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:setLoading(Loading.ShowMore);setNewUser(userId);count=nextUrl?visibleUsers.length:visibleUsers.length+1;_context2.prev=3;_context2.next=6;return getUsersFromServer(\"/api/v1/users?page=1&count=\".concat(count));case 6:_yield$getUsersFromSe2=_context2.sent;_users2=_yield$getUsersFromSe2.users;setUsers(_users2);_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](3);console.error(_context2.t0);case 14:_context2.prev=14;setLoading(Loading.None);return _context2.finish(14);case 17:case\"end\":return _context2.stop();}},_callee2,null,[[3,11,14,17]]);}));return function(_x){return _ref2.apply(this,arguments);};}(),[nextUrl,visibleUsers]);return{newUser:newUser,nextUrl:nextUrl,loading:loading,visibleUsers:visibleUsers,getUsers:getUsers,addNewUser:addNewUser,setLoading:setLoading};};","map":{"version":3,"names":["getUsersFromServer","useCallback","useMemo","useState","Loading","API","useUser","_useState","_useState2","_slicedToArray","nextUrl","setNextUrl","_useState3","None","_useState4","loading","setLoading","_useState5","_useState6","users","setUsers","_useState7","_useState8","newUser","setNewUser","visibleUsers","_toConsumableArray","getUsers","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_yield$getUsersFromSe","links","_users","path","wrap","_callee$","_context","prev","next","ShowMore","sent","next_url","length","replace","abrupt","oldData","concat","t0","console","error","finish","stop","addNewUser","_ref2","_callee2","userId","count","_yield$getUsersFromSe2","_users2","_callee2$","_context2","_x","apply","arguments"],"sources":["/Users/shkarupadenis/Documents/personal/TESTTASK/src/hooks/useUser.ts"],"sourcesContent":["import { getUsersFromServer } from \"api\";\nimport { useCallback, useMemo, useState } from \"react\";\nimport { Loading, User } from \"types\";\nimport { API } from \"utils/fetchClient\";\n\nexport const useUser = () => {\n  const [nextUrl, setNextUrl] = useState('/api/v1/users?page=1&count=6');\n  const [loading, setLoading] = useState<Loading>(Loading.None);\n  const [users, setUsers] = useState<User[]>([]);\n  const [newUser, setNewUser] = useState(0);\n\n  const visibleUsers = useMemo(() => [...users], [users]);\n\n  const getUsers = useCallback(async () => {\n    setLoading(Loading.ShowMore);\n\n    try {\n      const { links, users } = await getUsersFromServer(nextUrl);\n\n      const path = links.next_url;\n\n      if (!visibleUsers.length) {\n        setUsers(users);\n        setNextUrl(path.replace(API, ''));\n\n        return;\n      }\n\n      setNextUrl(path ? path.replace(API, '') : null);\n      setUsers((oldData) => [...oldData, ...users]);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setLoading(Loading.None);\n    }\n  }, [nextUrl, visibleUsers.length]);\n\n  const addNewUser = useCallback(async (userId: number) => {\n    setLoading(Loading.ShowMore);\n    setNewUser(userId)\n\n    const count = nextUrl ? visibleUsers.length : visibleUsers.length + 1;\n\n    try {\n      const { users } = await getUsersFromServer(\n        `/api/v1/users?page=1&count=${count}`\n      );\n\n      setUsers(users);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      setLoading(Loading.None);\n    }\n  }, [nextUrl, visibleUsers]);\n\n  return { \n    newUser,\n    nextUrl,\n    loading,\n    visibleUsers,\n    getUsers,\n    addNewUser,\n    setLoading,\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}